<html>
  <head>
    <title>Collider</title>

    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.1/underscore-min.js"></script>

    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/d3/2.7.4/d3.min.js"></script>
  </head>
  <body>
    <svg></svg>
    <script>
    var score = 0;
    var highScore = 0;
    d3.select('body').append('div').attr("class", "score").text("Current Score: " + score);
    d3.select('body').append('div').attr("class", "highScore").text("High Score: " + highScore);
    var scoreTimer = function() {
      setInterval(function() {
      score++;
      d3.select('.score')
      .text("Current Score: " + score);
      if (collision()) {
        if (score > highScore) {
          highScore = score;
        }
        score = 0;
        d3.select('.highScore').text("High Score: " + highScore);
      }
      }, 50);

    }();

    var width = 800;
    var height = 600;
    var svg = d3.select('svg');
    svg.attr('width', width).attr("height", height);

    var data = [{cx: Math.random() * width, cy: Math.random() * height, r: 10, fill: 'black'}, {cx: Math.random() * width, cy: Math.random() * height, r: 10, fill: 'black'}, {cx: Math.random() * width, cy: Math.random() * height, r: 10, fill: 'black'}, {cx: Math.random() * width, cy: Math.random() * height, r: 10, fill: 'black'}, {cx: Math.random() * width, cy: Math.random() * height, r: 10, fill: 'black'}, {cx: Math.random() * width, cy: Math.random() * height, r: 10, fill: 'black'}, {cx: Math.random() * width, cy: Math.random() * height, r: 10, fill: 'black'}, {cx: Math.random() * width, cy: Math.random() * height, r: 10, fill: 'black'}, {cx: Math.random() * width, cy: Math.random() * height, r: 10, fill: 'black'}, {cx: Math.random() * width, cy: Math.random() * height, r: 10, fill: 'black'}, {cx: Math.random() * width, cy: Math.random() * height, r: 10, fill: 'black'}, {cx: Math.random() * width, cy: Math.random() * height, r: 10, fill: 'black'}, {cx: Math.random() * width, cy: Math.random() * height, r: 10, fill: 'black'}, {cx: Math.random() * width, cy: Math.random() * height, r: 10, fill: 'black'}, {cx: Math.random() * width, cy: Math.random() * height, r: 10, fill: 'black'}, {cx: Math.random() * width, cy: Math.random() * height, r: 10, fill: 'black'}, {cx: Math.random() * width, cy: Math.random() * height, r: 10, fill: 'black'}, {cx: Math.random() * width, cy: Math.random() * height, r: 10, fill: 'black'}, {cx: Math.random() * width, cy: Math.random() * height, r: 10, fill: 'black'}, {cx: Math.random() * width, cy: Math.random() * height, r: 10, fill: 'black'}, {cx: Math.random() * width, cy: Math.random() * height, r: 10, fill: 'black'}, {cx: Math.random() * width, cy: Math.random() * height, r: 10, fill: 'black'}, {cx: Math.random() * width, cy: Math.random() * height, r: 10, fill: 'black'}, {cx: Math.random() * width, cy: Math.random() * height, r: 10, fill: 'black'}, {cx: Math.random() * width, cy: Math.random() * height, r: 10, fill: 'black'}]
    var enemies = svg.selectAll("circle").data(data);

    var loop = function(){
      d3.select(this)
      .transition().ease('back-in').duration(1000)
      .attr("cx", function(d){ return Math.random() * width; })
      .attr("cy", function(d){ return Math.random() * height; })
      .each("end", loop);
    };

    enemies.enter().append("circle")
      .attr("cx", function(d){ return d.cx; })
      .attr("cy", function(d){ return d.cy; })
      .attr("r", function(d){ return d.r; })
      .attr("fill", function(d){ return d.fill; })
    .transition().duration(1000)
      .attr("cx", function(d){ return Math.random() * width; })
      .attr("cy", function(d){ return Math.random() * height; })
      .each("end", loop);

       var drag = d3.behavior.drag()
        .on("drag", function(d,i) {
            d.cx += d3.event.dx
            d.cy += d3.event.dy
            d3.select(this).attr("cx", d.cx).attr("cy", d.cy)
        });

      d3.select('svg').append('circle')
      .data([ {"cx":width/2, "cy":height/2} ])
      .attr('class', 'player')
      .attr("cx", width/2)
      .attr("cy", height/2)
      .attr("r", 10)
      .attr("fill", "red")
      .call(drag);

      var collision = function(){
        var playerX = d3.select(".player").attr("cx");
        var playerY = d3.select(".player").attr("cy");
        var enemiesX = [];
        var enemiesY = [];
        enemies.each( function(){
          enemiesX.push(d3.select(this).attr("cx"));
        });
        enemies.each( function(){
          enemiesY.push(d3.select(this).attr("cy"));
        });
        for (var i = 0; i < enemiesY.length; i++) {
          if ((playerX) > (enemiesX[i] - 10) && (playerY) > (enemiesY[i] - 10) && (playerX) < (enemiesX[i] + 10) && (playerY) < (enemiesY[i] + 10)) {
            return true;
          }
        }
       return false;
      }

    </script>
  </body>
</html>